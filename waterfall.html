<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title></title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}
			body {
				background: #f3f2f3;
			}
			#main {
				border: 1px solid red;
				width: 1024px;
				margin: 0 auto;
				overflow : hidden;
			}
			.list {
				width: 256px;
				float: left;
			}
		</style>
	</head>
	<script>
		onload = function(){
			var loadBtn = document.getElementById("loadmore");
			var main = document.getElementById("main");
			
			window.addEventListener("scroll", function(){
				//console.log(document.body.scrollTop);
				//滚动到了底部
				console.log(document.body.scrollTop + window.innerHeight, document.body.offsetHeight);
				if(document.body.scrollTop + window.innerHeight == document.body.offsetHeight){
					loadImg();
				}
			});

			
		}
		
		function loadImg(){
				var req = new XMLHttpRequest();
				req.open("get", "http://localhost:8080/GP04/waterfall.txt?t=12419827192379123", true);
				req.send();
				req.onload = function(){
					console.log(req.response);
					var list = JSON.parse(req.response);

					list.forEach(function(img){
						var oImg = document.createElement("img");
						oImg.src = img.src;
						oImg.style.width = "256px";
						//main.children[3].appendChild(oImg);
						
						var cols = Array.from(main.children);
						
						cols.sort((a,b)=>a.offsetHeight-b.offsetHeight);
						
						cols[0].appendChild(oImg);
					});
				}
			}
	</script>
	<body>

		<div id="main">
			<div class="list">
			</div>
			<div class="list">
			</div>
			<div class="list">
			</div>
			<div class="list">
			</div>
		</div>
		<input type="button" name="" id="loadmore" value="加载图片" />
	</body>

</html>